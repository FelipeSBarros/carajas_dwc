--Script for the database table creation

quit()
cd Felipe/CARAJAS/Mestrado/

--considerando o uso do Rgedit...
sudo su
--senha
su postgres

--creating de database
createdb mestrado
--entering the db
psql mestrado


--creating tables and column definitions:
--flora_endemica
DROP TABLE flora_endemica;

CREATE TABLE flora_endemica(
id_reg serial not null primary key,
 num varchar(250),
 dups varchar(250),
 duplicata varchar(250),
 familia varchar(250),
 nome_cientifico varchar(250),
 categoria_ameaca varchar(250),
 gazetteer varchar(250),
 ambiente_resumido varchar(250),
 collector varchar(250),
 number varchar(250),
 Colldd varchar(250),
 Collmm varchar(250),
 Collyy varchar(250),
 lat_gr varchar(250),
 lat_min varchar(250),
 lat_sec varchar(250),
 lat varchar(250),
 ns varchar(250),
 long_gr varchar(250),
 long_min varchar(250),
 long_sec varchar(250),
 long varchar(250),
 ew varchar(250),
 zona varchar(250),
 lat_utm varchar(250),
 long_utm varchar(250),
datum varchar(250));
----------------------
--TNRS flora_endemica
CREATE TABLE tnrs_flora_endemica(
id_reg serial not null primary key,
Name_submitted varchar(250),
Name_matched varchar(250),
Author_matched varchar(250),
Overall_score numeric(4,2),
Taxonomic_status varchar(250),
Accepted_name varchar(250),
Accepted_author varchar(250),
Accepted_family varchar(250),
Source varchar(250),
Warnings varchar(250),
Accepted_name_lsid varchar(250));

--Copiando tabelas
----------------------
--Flora endemica
COPY public.flora_endemica (num, dups, duplicata, familia, nome_cientifico, categoria_ameaca, gazetteer, ambiente_resumido, collector, number, Colldd, Collmm, Collyy, lat_gr, lat_min, lat_sec, lat, ns, long_gr, long_min, long_sec, long, ew, zona, lat_utm, long_utm,datum) FROM '/home/felipe/Felipe/CARAJAS/Mestrado/Flora/Tabelas/20141128-endemicas carajas_consolidacao_Final.csv' WITH CSV HEADER;
--Inserindo uma coluna para ter nome TNRS
ALTER TABLE flora_endemica add tnrs_id integer;
--Inserindo coluna de geometria
ALTER TABLE flora_endemica add geom_sad geometry(POINT, 29192);
--Adocionando nova coluna com SRC diferente SIRGAS2000
ALTER TABLE flora_endemica add geom_sir geometry(POINT, 31982);
--adicionando as coordenadas à coluna de geometria SAD
UPDATE flora_endemica set geom_sad=ST_PointFromText('POINT('||long_utm|| ' ' || lat_utm || ')', 29192);
--adicionando as coordenadas à coluna de geometria SIRgas2000
UPDATE flora_endemica set geom_sir=ST_transform(geom_sad, 31982);

--TRNS Flora endemica
COPY public.tnrs_flora_endemica (Name_submitted,Name_matched,Author_matched,Overall_score,Taxonomic_status,Accepted_name,Accepted_author,Accepted_family,Source,Warnings,Accepted_name_lsid) FROM '/home/felipe/Felipe/CARAJAS/Mestrado/Flora/Tabelas/tnrs_results_flora_endemica.csv' WITH CSV HEADER;

--Adicionando a chave extrangeira do resultado tnrs a tabela flora_endemica
UPDATE flora_endemica a set tnrs_id=b.id_reg from tnrs_flora_endemica b where a.nome_cientifico=b.name_submitted ;
